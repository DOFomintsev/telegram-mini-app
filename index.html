<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Deal</title>

<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
body {
  margin: 0;
  background: #0f1115;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  color: white;
}

h1 {
  text-align: center;
  padding: 24px 0 10px;
  font-size: 22px;
  font-weight: 700;
}

.categories {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 16px;
  padding: 20px;
}

.category-card {
  background: linear-gradient(135deg, #1DB954, #16a34a);
  border-radius: 22px;
  padding: 28px 20px;
  text-align: center;
  color: white;
  box-shadow: 0 10px 25px rgba(29,185,84,0.35);
  transition: all 0.25s ease;
  cursor: pointer;
}

.category-card:active {
  transform: scale(0.96);
}

.icon {
  margin-bottom: 12px;
}

.label {
  font-size: 15px;
  font-weight: 600;
}

.prices {
  display: none;
  padding: 20px;
}

.price-btn {
  display: block;
  width: 100%;
  background: #1c1f26;
  border: 1px solid rgba(29,185,84,0.3);
  color: white;
  padding: 16px;
  margin-bottom: 12px;
  border-radius: 14px;
  font-size: 15px;
  font-weight: 600;
  cursor: pointer;
}

.back-btn {
  margin-top: 10px;
  text-align: center;
  font-size: 14px;
  opacity: 0.6;
  cursor: pointer;
}
</style>
</head>

<body>

<h1>Smart Deal</h1>

<div class="categories" id="categories"></div>
<div class="prices" id="prices"></div>

<script>
const tg = window.Telegram.WebApp;
tg.expand();

// üî• –í–ê–ñ–ù–û: –≤—Å—Ç–∞–≤—å —Å–≤–æ—é —Å—Å—ã–ª–∫—É CSV
const SHEET_URL = "https://docs.google.com/spreadsheets/d/1-JYl4b-6H_iWvBS2Zsez1K1DPx35iBUCCPPRiSrVY7o/export?format=csv";

let data = {};

async function loadData() {
  const response = await fetch(SHEET_URL);
  const text = await response.text();
  const rows = text.split("\n").slice(1);

  rows.forEach(row => {
    const [category, price, link] = row.split(",");
    if (!data[category]) data[category] = [];
    data[category].push({ price, link });
  });

  renderCategories();
}

function getIcon(category) {
  if (category === "–°–º–∞—Ä—Ç—Ñ–æ–Ω—ã") {
    return `
    <svg width="42" height="42" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <rect x="7" y="2" width="10" height="20" rx="2"></rect>
      <line x1="11" y1="18" x2="13" y2="18"></line>
    </svg>`;
  }

  if (category === "–ù–æ—É—Ç–±—É–∫–∏") {
    return `
    <svg width="42" height="42" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <rect x="4" y="5" width="16" height="10" rx="2"></rect>
      <path d="M2 17h20"></path>
    </svg>`;
  }

  return "üõçÔ∏è";
}

function renderCategories() {
  const container = document.getElementById("categories");
  container.innerHTML = "";

  Object.keys(data).forEach(category => {
    const div = document.createElement("div");
    div.className = "category-card";
    div.innerHTML = `
      <div class="icon">${getIcon(category)}</div>
      <div class="label">${category}</div>
    `;
    div.onclick = () => showPrices(category);
    container.appendChild(div);
  });
}

function showPrices(category) {
  document.getElementById("categories").style.display = "none";
  const pricesDiv = document.getElementById("prices");
  pricesDiv.style.display = "block";
  pricesDiv.innerHTML = "";

  data[category].forEach(item => {
    const btn = document.createElement("button");
    btn.className = "price-btn";
    btn.innerText = item.price;
    btn.onclick = () => tg.openLink(item.link);
    pricesDiv.appendChild(btn);
  });

  const back = document.createElement("div");
  back.className = "back-btn";
  back.innerText = "‚Üê –ù–∞–∑–∞–¥";
  back.onclick = () => {
    pricesDiv.style.display = "none";
    document.getElementById("categories").style.display = "grid";
  };
  pricesDiv.appendChild(back);
}

loadData();
</script>

</body>
</html>
