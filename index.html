<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Deal</title>

<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,sans-serif;
  background:linear-gradient(180deg,#0f1115,#111827);
  color:white;
}

header{
  text-align:center;
  padding:25px 10px 10px;
}

h1{
  margin:0;
  font-size:24px;
}

.subtitle{
  opacity:.6;
  font-size:14px;
  margin-top:4px;
}

.container{
  padding:20px;
}

.categories{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:18px;
}

.category-card{
  background:rgba(255,255,255,0.06);
  backdrop-filter:blur(18px);
  -webkit-backdrop-filter:blur(18px);
  border-radius:24px;
  padding:30px 20px;
  text-align:center;
  border:1px solid rgba(255,255,255,0.12);
  box-shadow:
    0 8px 32px rgba(0,0,0,0.35),
    inset 0 0 0 1px rgba(255,255,255,0.05);
  transition:.25s ease;
  cursor:pointer;
  position:relative;
  overflow:hidden;
}

.category-card::before{
  content:"";
  position:absolute;
  top:-50%;
  left:-50%;
  width:200%;
  height:200%;
  background:radial-gradient(circle at top left,
    rgba(255,255,255,0.18),
    transparent 60%);
  transform:rotate(25deg);
  pointer-events:none;
}

.category-card:active{
  transform:scale(.95);
}

.icon{
  margin-bottom:12px;
}

.label{
  font-weight:600;
  font-size:15px;
}

.price-list{
  display:flex;
  flex-direction:column;
  gap:14px;
}

.price-btn{
  padding:16px;
  border-radius:16px;
  border:none;
  font-size:15px;
  font-weight:600;
  cursor:pointer;
  background:linear-gradient(135deg,#22c55e,#16a34a);
  color:white;
  transition:.2s;
}

.price-btn:active{
  transform:scale(.96);
}

.back-btn{
  margin-bottom:20px;
  background:none;
  border:none;
  color:#22c55e;
  font-weight:600;
  font-size:15px;
  cursor:pointer;
}
</style>
</head>

<body>

<header>
  <h1>Smart Deal</h1>
  <div class="subtitle">Лучшие предложения онлайн</div>
</header>

<div class="container">
  <div id="app"></div>
</div>

<script>
const tg = window.Telegram.WebApp;
tg.expand();

const sheetURL = "https://docs.google.com/spreadsheets/d/1-JYl4b-6H_iWvBS2Zsez1K1DPx35iBUCCPPRiSrVY7o/export?format=csv";

let products = [];

function haptic(type="light"){
  if(tg.HapticFeedback){
    tg.HapticFeedback.impactOccurred(type);
  }
}

async function loadData(){
  const res = await fetch(sheetURL);
  const text = await res.text();
  const rows = text.split("\n").slice(1);

  products = rows.map(row=>{
    const cols = row.split(",");
    return {
      category: cols[0],
      price: cols[1],
      link: cols[2]
    }
  });

  renderCategories();
}

function renderCategories(){
  const app = document.getElementById("app");
  app.innerHTML="";

  const categories = [...new Set(products.map(p=>p.category))];

  const grid = document.createElement("div");
  grid.className="categories";

  categories.forEach(cat=>{
    const div=document.createElement("div");
    div.className="category-card";

    div.innerHTML=`
      <div class="icon">${getIcon(cat)}</div>
      <div class="label">${cat}</div>
    `;

    div.onclick=()=>{
      haptic("medium");
      showPrices(cat);
    };

    grid.appendChild(div);
  });

  app.appendChild(grid);
}

function showPrices(category){
  const app=document.getElementById("app");
  app.innerHTML="";

  const back=document.createElement("button");
  back.className="back-btn";
  back.innerText="← Назад";
  back.onclick=()=>{
    haptic("light");
    renderCategories();
  };

  app.appendChild(back);

  const list=document.createElement("div");
  list.className="price-list";

  products
    .filter(p=>p.category===category)
    .forEach(item=>{
      const btn=document.createElement("button");
      btn.className="price-btn";
      btn.innerText=item.price+" ₽";
      btn.onclick=()=>{
        haptic("light");
        tg.openLink(item.link);
      };
      list.appendChild(btn);
    });

  app.appendChild(list);
}

function getIcon(category){
  if(category==="Смартфоны"){
    return `
    <svg width="42" height="42" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <rect x="7" y="2" width="10" height="20" rx="2"></rect>
      <line x1="11" y1="18" x2="13" y2="18"></line>
    </svg>`;
  }

  if(category==="Ноутбуки"){
    return `
    <svg width="42" height="42" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <rect x="4" y="5" width="16" height="10" rx="2"></rect>
      <path d="M2 17h20"></path>
    </svg>`;
  }

  return `
    <svg width="42" height="42" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
      <circle cx="12" cy="12" r="10"></circle>
    </svg>`;
}

loadData();
</script>

</body>
</html>
